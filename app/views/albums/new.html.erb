<div class="new-album col">
  <div class="row">
    <h5 class="mt-4">New Album</h5>
    <hr class="w-100">
  </div>
  <div class="form-new-album">

    <%= form_with model: @album  do |form| %>
      <div class="form-row">
        <div class="form-group col-md-6 d-flex flex-column justify-content-between">
          <div>
            <%= form.label :title, "Title" %>
            <%= form.text_field :title, class:"form-control", id:"title" %>
          </div>
          <div class="w-50">
            <%= form.label :is_private, "Sharing mode" %>
            <%= form.select :is_private, options_for_select([["Public", false], ["Private", true]], false), class:"form-control", id:"is_private" %>
          </div>
        </div>
        <div class="form-group col-md-6">
          <%= form.label :description, "Description" %>
          <%= form.text_area :description, size: "30x10", class:"form-control", id:"description" %>
        </div>
      </div>
      <Div class="preview-photo-upload form-row">
        <div class="col-md-2 mt-3">
          <div class="album-upload-border d-flex justify-content-center align-items-center">
            <i class="fas fa-plus"></i>
            <%= form.fields_for :pictures do |f| %>
              <%= f.file_field :picture_url, class: "album-upload", id: "photo_url" %>
              <%= f.hidden_field :pictureable_id, value: @album.id %>
              <%= f.hidden_field :pictureable_type, value: "Album" %>
            <% end %>
          </div>
        </div>
      </div>
      <div>
        <%= form.submit "Save", class:"btn btn-success mt-5", id:"submit-album" %>
      </div>
    <% end %>
  
  </div>
</div>

<script>
  $(function() {
    // let imageUploadInAlbum = []
    $('.new-album #photo_url').on('change', function() {
      // inputFiles = this
      // for(const file of inputFiles.files) {
      //   file.name = "1" + file.name
      //   imageUploadInAlbum.push(file)
      // }
      previewPhoto(this)

    })
    
    $('.new-album').on('click', '#btn-delete-photo', function() {
      // let dataFile = this.data('data-file')
      console.log(this)
      let indexRemove = imageUploadInAlbum.indexOf($(this).attr('data-file'))
      imageUploadInAlbum.splice(indexRemove,1)
      $(this).parent().parent().remove()
    })

    function previewPhoto(input) {
      if (input.files && input.files.length) {
        // $('.new-album .form-new-album .preview-photo-upload').removeClass('form-row')
        for(const file of input.files) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const divForImage = `
              <div class="col-md-2 mt-3">
                <div class="position-relative">
                  <a class='position-absolute' style="top: 0; right: 0; color: white; z-index:100; cursor: pointer" id="btn-delete-photo" data-file='${file}'><i class="fas fa-window-close"></i></a>
                  <img width='180' height='180' src='${e.target.result}' class='position-absolute' >
                </div>
              </div>
              `
            $('.new-album .form-new-album .preview-photo-upload').append(divForImage)
          };

          reader.readAsDataURL(file);
        }
        $('.new-album .form-new-album .preview-photo-upload').height($('.preview-photo-upload').height())
        input.value = null
      }
    }
  
  })
</script>
